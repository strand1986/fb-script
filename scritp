(function() {
    if (typeof _fbq.instance.pixelsByID !== 'undefined') {     
        //console.log(`%cFacebook Pixel detected on this site`, ';'); 
        let pixels = _fbq.instance.pixelsByID;
        let pixelIDs ="";
            for (let pixelID in pixels) {
                if (pixels.hasOwnProperty(pixelID)) {
                    //console.log(`%cFound this pixel on the site ${pixelID}.`, ';');
                    pixelIDs += pixelID += " ";
                }
            }
        console.log(`%cThese Facebook pixels were found on the site ${pixelIDs}.`, ';');
        
        // Check for Automatic Matching
        if (typeof _fbq.instance.optIns._opts.AutomaticMatching === 'undefined') {
            console.log('%cAdvanced matching is NOT activated on this site for any pixel.', 'color: green;');
        } else {
            let matching = _fbq.instance.optIns._opts.AutomaticMatching;
            for (let pixelID in matching) {
                if (matching.hasOwnProperty(pixelID)) {
                    console.log(`%cAdvanced matching IS activated on this site for the pixelID ${pixelID}. This means that personal identifiers can be scraped and sent to Meta servers..`, 'color: red;');
                }
            }
        }
    
        // Check for Automatic Setup
        if (typeof _fbq.instance.optIns._opts.AutomaticSetup === 'undefined') {
            console.log('%cAdvanced setup is NOT activated on this site for any pixel.', 'color: green;');
        } else {
            let setup = _fbq.instance.optIns._opts.AutomaticSetup;
            for (let pixelID in setup) {
                if (setup.hasOwnProperty(pixelID)) {
                    console.log(`%cAdvanced setup IS activated on this site for the pixelID ${pixelID}. This means that user events are automatically tracked and sensitive information could be sent to Meta servers.`, 'color: red;');
                }
            }
        }
    } else {console.log(`%cNo Facebook Pixel detected on this site`, 'color: white;'); }
        console.log(`%cThis script is made by Ctrl Digital - If you need help or have questions about how to make your Facebook tracking safe, reach out to hello@ctrldigital.com`, 'color: white;');

})();
